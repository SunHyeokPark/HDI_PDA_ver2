# HDI PDA 테스트 시나리오

## 🎯 테스트 목표

1. **WebView 상태 보존**: 스캔 후 현재 페이지 유지 (최우선)
2. **바코드 스캔 정확성**: GUID 형식 정확히 인식
3. **안정성**: 연속 사용 시 충돌/오류 없음
4. **권한 관리**: 카메라 권한 정상 처리
5. **네트워크**: HTTP cleartext 정상 동작

## 📋 테스트 체크리스트

### 1. WebView 상태 보존 테스트 (최우선)

#### 1.1 페이지 위치 유지
- [ ] **시나리오**: 
  1. 앱 실행 → ERP 메인 페이지 로드
  2. 입고스캔 페이지로 이동
  3. 페이지 중간까지 스크롤
  4. 스캐너 버튼 클릭
  5. 바코드 스캔
  6. 복귀
- [ ] **검증**: 입고스캔 페이지 그대로 유지
- [ ] **검증**: 스크롤 위치 그대로 유지
- [ ] **실패 조건**: 메인 페이지로 돌아가거나 페이지가 새로고침됨

#### 1.2 입력 데이터 유지
- [ ] **시나리오**:
  1. 입고스캔 페이지에서 날짜 선택
  2. 일부 데이터 입력
  3. 스캐너 열기
  4. 바코드 스캔
  5. 복귀
- [ ] **검증**: 날짜 선택 값 유지
- [ ] **검증**: 기존 입력 데이터 유지
- [ ] **검증**: scan_bar에 새로운 스캔 값 추가

#### 1.3 여러 페이지 이동 후 테스트
- [ ] **시나리오**:
  1. 메인 → 페이지A → 페이지B → 입고스캔
  2. 스캔 실행
  3. 복귀
- [ ] **검증**: 입고스캔 페이지 유지
- [ ] **검증**: 뒤로가기 버튼으로 이전 페이지 이동 가능

### 2. 바코드 스캔 기능 테스트

#### 2.1 정상 GUID 스캔
- [ ] **테스트 데이터**: `550e8400-e29b-41d4-a716-446655440000`
- [ ] **검증**: scan_bar에 정확히 입력됨
- [ ] **검증**: 진동 피드백 발생
- [ ] **검증**: 스캐너 자동 종료

#### 2.2 중괄호 포함 GUID
- [ ] **테스트 데이터**: `{550e8400-e29b-41d4-a716-446655440000}`
- [ ] **검증**: 중괄호 제거된 값이 입력됨
- [ ] **검증**: 정상 처리

#### 2.3 잘못된 형식 거부
- [ ] **테스트 데이터**: `123456789`
- [ ] **검증**: 스캔되지 않음 (계속 스캔 모드 유지)
- [ ] **테스트 데이터**: `not-a-guid`
- [ ] **검증**: 스캔되지 않음

#### 2.4 기존 로직 트리거
- [ ] **시나리오**:
  1. GUID 바코드 스캔
  2. scan_bar에 값 입력됨
- [ ] **검증**: 기존 keyup 이벤트 핸들러 동작
- [ ] **검증**: 서버 조회 자동 실행
- [ ] **검증**: 리스트에 데이터 추가
- [ ] **검증**: 전표 모달 표시 (옵션 켜진 경우)

### 3. 연속 스캔 테스트

#### 3.1 5회 연속 스캔
- [ ] **시나리오**: 스캐너 열기 → 스캔 → 닫기 × 5회 반복
- [ ] **검증**: 모든 스캔 정상 동작
- [ ] **검증**: 메모리 누수 없음
- [ ] **검증**: 앱 충돌 없음
- [ ] **검증**: scan_bar에 5개 값 순차 입력

#### 3.2 빠른 연속 스캔
- [ ] **시나리오**: 
  1. 첫 번째 스캔 완료
  2. 즉시 두 번째 스캔 시도
- [ ] **검증**: 중복 스캔 방지 (isScanning 플래그)
- [ ] **검증**: 스캐너 정상 종료 후 재시작

#### 3.3 취소 후 재시작
- [ ] **시나리오**:
  1. 스캐너 열기
  2. 닫기 버튼 클릭 (스캔 없이)
  3. 다시 스캐너 열기
- [ ] **검증**: 정상 동작
- [ ] **검증**: 이전 스캔 값 영향 없음

### 4. 권한 관리 테스트

#### 4.1 초기 권한 요청
- [ ] **시나리오**: 앱 최초 설치 후 스캐너 실행
- [ ] **검증**: 카메라 권한 요청 다이얼로그 표시
- [ ] **검증**: 권한 설명 메시지 표시

#### 4.2 권한 허용
- [ ] **시나리오**: 권한 요청 → 허용
- [ ] **검증**: 스캐너 정상 실행
- [ ] **검증**: 카메라 프리뷰 정상 표시

#### 4.3 권한 거부
- [ ] **시나리오**: 권한 요청 → 거부
- [ ] **검증**: 권한 필요 안내 메시지 표시
- [ ] **검증**: 스캐너 실행 안 됨

#### 4.4 권한 재요청
- [ ] **시나리오**: 
  1. 권한 거부
  2. 다시 스캐너 버튼 클릭
- [ ] **검증**: 권한 설명과 함께 재요청
- [ ] **검증**: "다시 묻지 않음" 선택 시 설정으로 이동 안내

#### 4.5 설정에서 권한 변경
- [ ] **시나리오**:
  1. 설정 → 앱 → HDI PDA → 권한 → 카메라 거부
  2. 앱에서 스캐너 실행
  3. 설정으로 돌아가서 권한 허용
  4. 앱에서 다시 스캐너 실행
- [ ] **검증**: 권한 상태 변경 감지
- [ ] **검증**: 허용 후 정상 동작

### 5. 네트워크 테스트

#### 5.1 HTTP Cleartext 접속
- [ ] **URL**: `http://erp.hdi21.co.kr/mobile/`
- [ ] **검증**: 페이지 정상 로드
- [ ] **검증**: 로그인 정상 동작
- [ ] **검증**: 네트워크 오류 없음

#### 5.2 HTTPS 접속 (혼합)
- [ ] **시나리오**: HTTP 페이지에서 HTTPS 리소스 로드
- [ ] **검증**: 혼합 컨텐츠 정상 표시
- [ ] **검증**: 이미지/스크립트 로드 정상

#### 5.3 오프라인 처리
- [ ] **시나리오**:
  1. 앱 실행 중 WiFi/모바일 데이터 끄기
  2. 페이지 이동 시도
- [ ] **검증**: 네트워크 오류 메시지 표시
- [ ] **검증**: 앱 충돌 없음

#### 5.4 온라인 복귀
- [ ] **시나리오**:
  1. 오프라인 상태에서 에러 발생
  2. 네트워크 다시 연결
  3. 페이지 새로고침
- [ ] **검증**: 정상 복구
- [ ] **검증**: 데이터 정상 로드

### 6. UI/UX 테스트

#### 6.1 스캐너 UI
- [ ] **검증**: 카메라 프리뷰 정상 표시
- [ ] **검증**: 스캔 가이드 프레임 표시
- [ ] **검증**: 상태 텍스트 변경 (스캔 전/후)
- [ ] **검증**: 닫기 버튼 동작
- [ ] **검증**: 플래시 토글 동작

#### 6.2 진동 피드백
- [ ] **검증**: 스캔 성공 시 진동 발생
- [ ] **검증**: Android 8.0 이상에서 VibrationEffect 사용
- [ ] **검증**: Android 8.0 미만에서 레거시 API 사용

#### 6.3 화면 회전
- [ ] **시나리오**: 스캐너 실행 중 기기 회전
- [ ] **검증**: 세로 모드 유지 (회전 안 됨)
- [ ] **검증**: MainActivity는 configChanges로 재생성 방지

### 7. 성능 테스트

#### 7.1 앱 시작 시간
- [ ] **측정**: 아이콘 탭 → 첫 페이지 표시
- [ ] **목표**: 3초 이내

#### 7.2 스캐너 시작 시간
- [ ] **측정**: 버튼 탭 → 카메라 프리뷰 표시
- [ ] **목표**: 2초 이내

#### 7.3 스캔 인식 속도
- [ ] **측정**: 바코드 노출 → 스캔 완료
- [ ] **목표**: 1초 이내

#### 7.4 메모리 사용량
- [ ] **측정**: Android Studio Profiler 사용
- [ ] **검증**: 메모리 누수 없음
- [ ] **검증**: 연속 스캔 시 메모리 증가 없음

### 8. 다양한 기기 테스트

#### 8.1 저사양 기기
- [ ] **기기**: Android 7.0, 2GB RAM
- [ ] **검증**: 앱 정상 동작
- [ ] **검증**: 스캔 속도 허용 범위

#### 8.2 고사양 기기
- [ ] **기기**: Android 14, 8GB RAM
- [ ] **검증**: 모든 기능 정상 동작
- [ ] **검증**: 고해상도 카메라 지원

#### 8.3 다양한 화면 크기
- [ ] **검증**: 5인치 스마트폰
- [ ] **검증**: 6.5인치 대형 스마트폰
- [ ] **검증**: 7인치 태블릿

### 9. 에러 처리 테스트

#### 9.1 카메라 초기화 실패
- [ ] **시나리오**: 다른 앱이 카메라 사용 중
- [ ] **검증**: 오류 메시지 표시
- [ ] **검증**: 앱 충돌 없이 복귀

#### 9.2 ML Kit 모델 로드 실패
- [ ] **시나리오**: 오프라인 + 모델 미다운로드
- [ ] **검증**: 적절한 오류 메시지
- [ ] **대안**: 번들 모델로 전환 고려

#### 9.3 WebView 로드 실패
- [ ] **시나리오**: 잘못된 URL 또는 서버 다운
- [ ] **검증**: 오류 메시지 표시
- [ ] **검증**: 재시도 가능

## 🔍 추가 검증 항목

### JavaScript Interface
```javascript
// 브라우저 개발자 도구에서 확인
console.log(window.Native); // object
console.log(typeof window.Native.openScanner); // function
console.log(window.Native.isNativeApp()); // true
console.log(window.Native.getAppVersion()); // "1.0.0"
```

### ADB 로그 확인
```bash
# 앱 로그 필터링
adb logcat | grep "HDI PDA\|ScannerActivity\|MainActivity"

# 중요 로그 확인:
# - "Opening native scanner"
# - "Barcode detected"
# - "Barcode injected successfully"
```

### APK 분석
```bash
# APK 정보
aapt dump badging app-release.apk | grep -E "package|version|permission"

# 권한 확인
# - android.permission.INTERNET ✓
# - android.permission.CAMERA ✓
# - android.permission.VIBRATE ✓
```

## 📊 테스트 리포트 템플릿

```markdown
## 테스트 리포트

**테스트 일자**: YYYY-MM-DD
**테스트 환경**: 
- 기기: [기기명]
- Android 버전: [버전]
- 앱 버전: [버전]

**테스트 결과**:
- WebView 상태 보존: ✓ / ✗
- 바코드 스캔 정확성: ✓ / ✗
- 연속 스캔 안정성: ✓ / ✗
- 권한 관리: ✓ / ✗
- 네트워크 연결: ✓ / ✗

**발견된 이슈**:
1. [이슈 설명]
   - 재현 방법: 
   - 예상 동작:
   - 실제 동작:
   - 우선순위: High/Medium/Low

**추가 의견**:
[테스트 과정에서의 소견]
```

## ✅ 배포 전 최종 체크리스트

- [ ] 모든 주요 시나리오 테스트 통과
- [ ] 최소 3개 이상의 다른 기기에서 테스트
- [ ] 네트워크 환경 (WiFi, 모바일 데이터) 테스트
- [ ] 권한 관리 정상 동작 확인
- [ ] WebView 상태 보존 100% 확인
- [ ] 연속 스캔 10회 이상 무오류 확인
- [ ] ADB 로그에서 에러 없음 확인
- [ ] Release APK 서명 확인
- [ ] ProGuard 적용 후 정상 동작 확인
